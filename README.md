# GCP Image Vulnerability Alerter
This repository contains a Ruby script that uses the [Google Cloud Container Analaysis API](https://cloud.google.com/container-registry/docs/reference/rest/) to post alerts to a specified Slack channel when Docker images with high or critical vulnerabilities are uploaded to the formal [GCR](https://cloud.google.com/container-registry/) repositories. A [Google Cloud Firestore](https://firebase.google.com/docs/firestore/) database is used to track a little state to ensure duplicate updates aren't posted.

## Installation
* Ensure that [Ruby](https://www.ruby-lang.org/en/downloads/) is installed
* Install [Bundler](https://bundler.io/) using `gem install bundler`
* Install the RubyGems this script depends on using `bundle install`

## Running
### Environment Variables
The environment variables below are required:

```
CONTAINER_ANALYSIS_CREDENTIALS         # Path to the GCP service account JSON key
CONTAINER_ANALYSIS_PROJECT             # Name of the GCP project containing the Docker images
FIRESTORE_PROJECT                      # Name of the GCP project containing the Firestore project
GCP_VULNERABILITY_ALERTS_SLACK_CHANNEL # Name of the Slack channel to post alerts to
SLACK_WEBHOOK
```

Run the script using `bundle exec ./gcp_image_vulnerability_alerter.rb`.

## Copyright
Copyright (C) 2019 Crown Copyright (Office for National Statistics)