# frozen_string_literal: true

# Class that represents a package issue.
class PackageIssue
  def initialize(severity, description, package)
    @severity    = severity
    @description = description
    @package     = package
  end

  def description
    return "#{@description} (#{@related_url})" unless @related_url.nil?

    @description
  end

  # Only set the related URL if it contains the same CVE number as present in the package description.
  def related_url=(url)
    @related_url = url if url.include?(@description)
  end

  def to_slack_attachment
    color = @severity == 'CRITICAL' ? 'danger' : 'warning'
    text  = "Package `#{@package}` #{description}."
    {
      'color': color,
      'fallback': text,
      'title': @severity.capitalize,
      'text': text
    }
  end
end
